> [!CAUTION]
> Please do not edit this file (page) manually since the workflow will overwrite your changes.
>
> This file (page) is automatically generated by the workflow `Update test problem wiki page` using the script `tool/wiki/sync_test_problem_pages.py`.
>
> The workflow is triggered by push changes to any of `example/test_problem/*/*/README.md` and `tool/wiki/sync_test_problem_pages.py`.


# `configure.py` options
- Must enable
  - [[--model | Installation:-Option-List#--model]]=`ELBDM`
  - [[--gravity | Installation:-Option-List#--gravity]]
  - [[--particle | Installation:-Option-List#--particle]] (optional for `HaloMerger_ParCloud_InitMode`=`1`)
  - [[--gsl | Installation:-Option-List#--gsl]] (optional for `HaloMerger_ParCloud_InitMode`=`1`)
- Must disable
  - [[--comoving | Installation:-Option-List#--comoving]]
  - [[--elbdm_scheme | Installation:-Option-List#--elbdm_scheme]]=`HYBRID`
- Available options
  - [[Miscellaneous Options | Installation:-Option-List#miscellaneous-options]]


# Default setup
- Code units
  - `UNIT_L` = Mpc/h, where h=0.6955 is the present dimensionless Hubble parameter
             = 1437.814521231748 kpc
  - `UNIT_V` = 100 km/s
  - `UNIT_D` = rho_bg (background matter density at z=0)
             = 38.06 Msun/kpc^3

    - Mass density and wavefunction are normalized to rho_bg
  - `UNIT_T` = 14068.4678922741 Myr
  - `UNIT_M` = 1.131e+11 Msun

- ELBDM
  | Parameter name         | Value   |
  |------------------------|---------|
  | ELBDM_MASS             | 1.0e-22 |
  | ELBDM_REMOVE_MOTION_CM | 0       |
  | ELBDM_TAYLOR3_AUTO     | 0       |

- Boundary conditions
  | Parameter name | Value | Note     |
  |----------------|-------|----------|
  | OPT__BC_FLU_*  | 1     | periodic |
  | OPT__BC_POT    | 2     | isolated |

- AMR
  | Parameter name | Value |
  |----------------|-------|
  | MAX_LEVEL      | 3     |
  | OPT__FLAG_RHO  | 1     |

- Simulation
  | Parameter name | Value |
  |----------------|-------|
  | END_T          | 0.25  |


# Note
- Simulate the merger of halos and solitons in an external potential

- Edit `Input_TestProb_Halo` to specify the parameters for the halos

  - Add new parameters with increasing indexes if the number of halos is more than 2

  - For `HaloMerger_Halo_InitMode`=`1`
    - The initial condition of halos is constructed by reading the `HALO_IC` file as a table and performing linear interpolation
      - Note that this `HALO_IC` has nothing to do with the built-in option [[OPT__INIT | Runtime-Parameters:-Initial-Conditions#OPT__INIT]]=`3`
    - The `HALO_IC` must be single AMR level
      - If there is a halo `UM_IC` (for [[OPT__INIT | Runtime-Parameters:-Initial-Conditions#OPT__INIT]]=`3`) that has multiple AMR levels (and there is `Input__UM_IC_RefineRegion`),
        the Python script `Make_UM_IC_uniform.py` is provided to convert it to
        a single-level `UM_IC` with the specified level, which can be used as the `HALO_IC`
        (However, those levels higher than Target_lv+log_2( 2*PatchSize ) cannot be handled and will be ignored)
      - If converting the halo `UM_IC` to be single-level is not feasible,
        switching to the initialization option [[OPT__INIT | Runtime-Parameters:-Initial-Conditions#OPT__INIT]]=`3` to load a multi-level `UM_IC` is also an alternative
        (However, only one `UM_IC` can be loaded and all the parameters in `Input_TestProb_Halo` will not be used)
    - Note that `HaloMerger_Halo_*_CenCoord*` in `Input__TestProb_Halo` is the `HALO_IC` box center rather than the exact halo center

- Edit `Input_TestProb_Soliton` to specify the parameters for the solitons

  - Add new parameters with increasing indexes if the number of solitons is more than 2

  - For `HaloMerger_Soliton_InitMode`=`1`
    - The initial condition of solitons is constructed by reading the table of soliton density profile
      (the density profile will be rescaled to the given core radius or core density if `HaloMerger_Soliton_*_DensProf_Rescale`=`1`)

  - For `HaloMerger_Soliton_InitMode`=`2`
    - The initial condition of solitons is constructed by using the analytical formula of the soliton density profile

- Edit `Input_TestProb_ParCloud` to specify the parameters for the particle clouds

  - Add new parameters with increasing indexes if the number of particle clouds is more than 2

  - For `HaloMerger_ParCloud_InitMode`=`1`
    - The initial condition of particle clouds is constructed by reading the table of density profile and using `Par_EquilibriumIC()`
    - The default particle clouds use the HaloDensityProfile (see Note 7. below) to represent the CDM halos
    - Enable compilation options: [[--particle | Installation:-Option-List#--particle]], [[--gsl | Installation:-Option-List#--gsl]]
    - Set the parameter [[OPT__FREEZE_FLUID | Runtime-Parameters:-Hydro#OPT__FREEZE_FLUID]] to 1 in `Input__Parameter` for particle-only simulations

- Turn on [[OPT__EXT_POT | Runtime-Parameters:-Gravity#OPT__EXT_POT]]=`1` to add external potential

  - The external potential of a uniform-density sphere, which is proportional to `r^2` inside and proportional to `1/r` outside

- Download the default `HALO_IC` file
  ```bash
  sh download_ic.sh
  ```

  - Halo mass = 4.0960e+09 Msun
  - Without soliton
  - N = 640, L = 0.0646921095 Mpc/h, single-precision

- Generate the default HaloDensityProfile and SolitonDensityProfile
  ```bash
  python Make_DensityProfile.py
  ```

  - The parameters for the halo density profile are used to fit the ELBDM halo

- Some examples of yt visualization scripts are put in `plot_script`

- The corresponding wavelength is 0.00083778702 Mpc/h when [[ELBDM_MASS | Runtime-Parameters:-ELBDM#ELBDM_MASS]]=`1.0e-22` and velocity = 1.0*100 km/s

  - Make sure the resolution is high enough to resolve the wavelength

- The input halos and solitons may overlap with each other initially

  - Their wavefunctions, instead of densities, are added directly
  - Note that the interference will cause the density distribution to be different from the sum of individual density

# Links
[[Main page of Test Problems | Test-Problems]]

